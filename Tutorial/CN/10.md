# 10. 顶点钳制
版本v3.0.0的另一个新增特性是：**顶点钳制**。它是[**顶点位移**](https://github.com/Blatke/Standard-Shader-for-ME/blob/main/Tutorial/CN/9.md)的衍生功能，这里虽独立来讲，但还建议先行了解《顶点位移》，再阅读本章内容。本章涉及的网格和贴图均在《顶点位移》一章中提及，这里不再重复。

这里的顶点钳制功能，可以理解为给顶点的位置施加一种限制范围（或曰“**钳制边界**”），超出限制范围边界的顶点，将被推回到边界边缘，而没有超出边界的顶点则不受影响。有关选项名称以“VertClamp”字样为开头。

## 启用钳制
找到**F501_VertClamp**参数选项，调整其数值为1.0，即启动顶点钳制功能。

![AI_2025-06-05-11-13-52-813](https://github.com/user-attachments/assets/e4eb251d-3c4f-4dbd-bc14-d54440e8e7c0)

找到**F521_VertClampUpper_X**、**F531_VertClampUpper_Y**、**F541_VertClampUpper_Z**选项，这三个选项**以网格原点为XYZ轴中心点**，根据各自参数数值分别界定了钳制边界的X、Y、Z值上限。钳制边界的下限我们可能不太常用，所以这里以**F551_VertClampLowerXYZ**单个选项来作界定。

![AI_2025-06-05-11-14-40-2141](https://github.com/user-attachments/assets/4f6f0089-fb96-45bd-ba02-b04a4191853f)

钳制边界这个说法有些抽象，如果将它理解为一个有边框的包围盒，那么它的边界及其各个端点大概如下图模拟所示。同时，由于这个边界超出了网格的所有顶点位置，所以没有任何顶点受到钳制影响。

![AI_2025-06-05-11-14-58-264](https://github.com/user-attachments/assets/61faff1c-1d55-43af-85cf-1688d8e123d2)

调整**F521_VertClampUpper_X**、**F531_VertClampUpper_Y**、**F541_VertClampUpper_Z**选项，使边界范围缩小，乃至退到网格部分顶点的后面。正如上面对顶点钳制的界定所述，超出钳制边界的顶点会改变位置，使顶点落在钳制边界的边缘上。随着选项数值的变化，边界范围也不断改变，受影响的顶点及其位置也在变化，于是在视觉上形成了网格类似被“挤压”或“切割”的效果。（网格表面存在一定的凹凸造型，这是上一章使用贴图A实现顶点位移后的结果。）

![10](https://github.com/user-attachments/assets/4cc8da30-fc5a-41a6-a1ee-82089e605812)

> [!NOTE]
>
> 尽管直观上网格似乎被“切割”，但事实上受影响的顶点只是落在钳制边界边缘上，并没有顶点消失（或曰“放弃渲染”），否则网格将出现豁口。仔细观察上图不难发现，当边界完全退到网格背后时，网格亦没有消失，而是变成了扁平的一张面饼，随着边界的后退而后退，因为此时网格所有的顶点都挤在了边界边缘上。

## 让被钳制的顶点变暗/变亮
同[上一章](https://github.com/Blatke/Standard-Shader-for-ME/blob/main/Tutorial/CN/9.md#%E8%AE%A9%E4%BD%8D%E7%A7%BB%E7%9A%84%E9%A1%B6%E7%82%B9%E5%8F%98%E6%9A%97%E5%8F%98%E4%BA%AE)的概念和操作相似，被钳制的顶点也同样可以改变其环境光遮蔽数值（Occlusion），使用F515_VertClampOcclusion选项进行加数/减数的调整。

![11](https://github.com/user-attachments/assets/c2d6456e-ede3-40cf-9159-e2797d5b40f0)

## 旋转钳制边界
如果钳制边界总是与XYZ轴平行，那么钳制的灵活性就被局限了。我们希望它至少可以沿某一个轴来旋转，使钳制边界的边缘倾斜。调整**F562_VertClampBoundRotateAxis_X**、**F563_VertClampBoundRotateAxis_Y**、**F564_VertClampBoundRotateAxis_Z**三个选项，可让钳制边界以某个轴为中心进行-180度到180度的旋转。继续将钳制边界想象为包围盒的话，其边框和钳制效果（沿X轴旋转）可模拟为下图：

![AI_2025-06-05-11-23-48-442](https://github.com/user-attachments/assets/2bb868a5-b052-4374-8863-737f47c0d711)

动态调整的效果：

![12](https://github.com/user-attachments/assets/e339b793-1200-4f54-a4e2-dee115927df3)

> [!NOTE]
>
> 1. 目前钳制边界尚无法实现沿三个轴同时旋转的效果，仅能实现沿单一轴旋转。当**F562_VertClampBoundRotateAxis_X**、**F563_VertClampBoundRotateAxis_Y**、**F564_VertClampBoundRotateAxis_Z**三个选项都有非零数值时，旋转轴心和参数以数值绝对值最大的选项为准。
> 2. 钳制边界旋转的轴心总是网格的原点。
