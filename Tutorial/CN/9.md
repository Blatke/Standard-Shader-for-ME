# 9.让网格顶点实现位移
在v3.0.0版本以后，本着色器mod新增了以“Displacement”为开头字样的一系列属性，它们能够使网格的顶点根据一张贴图所映射的布局和程度来进行位移。

## 位移贴图
假设场景中已添加了一个长方体，它的每个面的UV布局都与这个长方体的UV布局完全重合，即每个面的UV布局都完全覆盖了整个[0,1]x[0,1]区域，因此当导入任一贴图时，每个面都毫无遗漏地反映了这张贴图的全部纹理（尽管有所拉伸）。

![AI_2025-06-05-10-40-18-269](https://github.com/user-attachments/assets/4da80228-472e-41c7-95b5-248534eff3ee)

现在，找到**F_DisplacementMap**贴图选项，导入一张位移贴图：

![AI_2025-06-05-10-40-38-454](https://github.com/user-attachments/assets/ea9644f9-e348-4cde-8cb0-5ff3d22851ce)

假设位移贴图是一张PNG格式的无压缩贴图。它的背景是黑色(0,0,0)，前景是红色(1,0,0)，并且红色—黑色之间存在一定渐变效果：

![Displacement boobs](https://github.com/user-attachments/assets/cb9a9b62-2760-4b66-bc86-12ea4a7604cd)

## 根据贴图实现位移
找到**F100_DisplacementStrength**参数选项，拖动滑块，使之参数大于0。此时，顶点位移功能开启，并读取位移贴图中每个像素的数值，再将这些像素及其数值映射到长方体每个面的顶点上。在其它选项默认条件不变情况下，随着**F100_DisplacementStrength**参数的变化，贴图所映射位置的顶点将**沿着法线方向**移动。由于我们在这里使用的是长方体，所以相应顶点的移动方向就是它们所在的每个面的朝向。顶点移动的幅度是贴图中非零数值和**F100_DisplacementStrength**数值的乘积。如下图所示，位移贴图的红色部分随**F100_DisplacementStrength**参数增大而逐渐凸起；凸起幅度较小的部分由位移贴图中红色—黑色渐变部分所决定。

![1](https://github.com/user-attachments/assets/67a2092e-0704-40c2-b066-5bffd79492ba)

## 网格细分
顶点的位移造就了网格造型的变化，但如果网格的顶点数过少，那么这种变化往往是平直的、粗糙的。增加**F110_Tessellation**选项的数值，可以在GPU端暂时提高网格的细分程度，成倍增加顶点数，使网格顶点位移更加平滑一些。

![2](https://github.com/user-attachments/assets/aebf54e4-bb11-4adc-adbc-29537772c6e4)

> [!CAUTION]
>
> 增加网格的细分程度将显著提高GPU渲染压力，因此不建议使用过大的数值。

## 让位移的顶点变暗/变亮
可以分别使用**F115_DisplacementOcclusionBump**和**F116_DisplacementOcclusionDent**选项为位移中凸起或凹陷的顶点设置加数或减数。这些加数和减数将累积到网格顶点的环境光遮蔽参数（Occlusion）中，如果加减后得到的遮蔽参数小于1.0，则顶点在光照下会显得更暗。在下图中，**F115_DisplacementOcclusionBump**被设为负数，这样在位移中被凸起的顶点就会更暗些。换言之，我们也可以通过这个方法，查看哪些顶点是凸起的，哪些是凹陷的。

![3](https://github.com/user-attachments/assets/238cf614-d66f-414e-bb0a-b35c399db135)

## 根据RGB通道决定不同的位移
上面的例子仅使用了一张红黑贴图，也就是贴图的所有像素的RGB通道只有红色通道被使用。我们也可以使用另外两个通道——绿色和蓝色通道，并单独决定它们所映射的顶点如何位移。

